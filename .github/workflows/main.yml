
name: Deploy Supabase Functions

on:
  push:
    branches:
      - main
    paths:
      - 'supabase/functions/**'
      - '.github/workflows/main.yml'

jobs:
  deploy:
    runs-on: ubuntu-latest

    steps:
      - uses: actions/checkout@v4
      - uses: actions/setup-node@v4
        with:
          # ðŸ’¡ ä¿®æ­£ç‚¹ 1: Node.js ãƒãƒ¼ã‚¸ãƒ§ãƒ³ã‚’ 20 ã«å¤‰æ›´
          node-version: 20

      # ðŸ’¡ ä¿®æ­£ç‚¹ 2: Supabase CLI ã‚’ curl ã§ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«
      - name: Install Supabase CLI
        run: curl -sL https://raw.githubusercontent.com/supabase/cli/main/install.sh | sh
        
      # ðŸ’¡ ä¿®æ­£ç‚¹ 3: CLIã®PATHã‚’é€šã™
      - name: Setup Supabase CLI Path
        run: echo "$HOME/.supabase/bin" >> $GITHUB_PATH

      # Bot Function ã‚’ãƒ‡ãƒ—ãƒ­ã‚¤
      - name: Deploy Function
        run: |
          supabase functions deploy slack-coordi-bot --no-verify-jwt
        env:
          SUPABASE_ACCESS_TOKEN: ${{ secrets.SUPABASE_ACCESS_TOKEN }}
          SUPABASE_PROJECT_REF: ${{ secrets.SUPABASE_PROJECT_REF }}
