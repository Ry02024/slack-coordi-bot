
name: Deploy Supabase Functions

on:
  push:
    branches:
      - main
    paths:
      - 'supabase/functions/**'
      - '.github/workflows/main.yml'
  workflow_dispatch:
    inputs:
      reason:
        description: 'Manual deployment reason'
        required: false
        default: 'Manual trigger from GitHub Actions tab'

jobs:
  deploy:
    runs-on: ubuntu-latest

    steps:
      - uses: actions/checkout@v4
      - uses: actions/setup-node@v4
        with:
          node-version: 20

      # Supabase CLI ã®ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«
      - name: Install Supabase CLI using action
        uses: supabase/setup-cli@v1
        with:
          version: latest

      # Bot Function ã‚’ãƒ‡ãƒ—ãƒ­ã‚¤
      - name: Deploy Function
        run: |
          # ğŸ’¡ ä¿®æ­£ç‚¹: --project-ref ã‚’å¼•æ•°ã¨ã—ã¦æ˜ç¤ºçš„ã«æ¸¡ã™
          supabase functions deploy slack-coordi-bot \
            --no-verify-jwt \
            --project-ref ${{ secrets.SUPABASE_PROJECT_REF }}
        env:
          SUPABASE_ACCESS_TOKEN: ${{ secrets.SUPABASE_ACCESS_TOKEN }}
          # SUPABASE_PROJECT_REF ã¯ã‚³ãƒãƒ³ãƒ‰å¼•æ•°ã§æ¸¡ã™ãŸã‚ã€ç’°å¢ƒå¤‰æ•°ã‹ã‚‰ã¯å‰Šé™¤ã—ã¦ã‚‚è‰¯ã„ãŒã€æ®‹ã—ã¦ãŠã
          SUPABASE_PROJECT_REF: ${{ secrets.SUPABASE_PROJECT_REF }}
